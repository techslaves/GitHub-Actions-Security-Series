# 2: GitHub Actions Authentication & Authorization Model

## GitHub identities

Before securing a workflow, you must understand the three primary ways to authenticate with GitHub.

| Identity | Scope | Lifetime | Best For... |
| --- | --- | --- | --- |
| **GITHUB_TOKEN** | Single Repository | Duration of the job | Standard CI/CD tasks (testing, internal PRs). |
| **Personal Access Token (PAT)** | User-level (Fine-grained or Classic) | User-defined (up to 1 year) | Local development, CLI, or cross-repo actions. |
| **GitHub App Token** | App-level | Short-lived (1 hour) | Scalable integrations, multi-repo automation, and bypasses. |

## Default permissions of `GITHUB_TOKEN`

By default, the token's power depends on your **Organization or Repository settings**:

1. **Permissive (Read/Write):** Historical default; gives the token write access to contents, issues, and PRs.
2. **Restricted (Read-only):** The modern security standard; gives read access only.

## The `permissions` Key

To follow the **Principle of Least Privilege**, you should explicitly define permissions in your YAML file. You can set this at the **top level** (applies to all jobs) or **job level**.

```jsx
name: Secure CI
on: [push]

# Top-level: Restrict everything by default
permissions:
  contents: read

jobs:
  label-pr:
    runs-on: ubuntu-latest
    # Job-level: Elevate only what is needed here
    permissions:
      pull-requests: write
    steps:
      - uses: actions/labeler@v4
```

##  Levels of Permission Management

1. **Organization Level:** Global policies (e.g., "All workflows must be read-only by default").
2. **Repository Level:** Overrides for a specific project.
3. **Environment Level:** Controls access to secrets and deployment protection rules (like manual approvals).

## ðŸŽ¬ Demo Content:

1. Create a workflow as below (with default settings of GITHUB_TOKEN in repository)

```jsx
name: GitHub token permission Demo
on: [push]
  
jobs:
  leak-job:
    runs-on: ubuntu-latest
    steps:   
      - name: Checkout code
        uses: actions/checkout@v4
        
      - name: Leak via Character Splitting
        run: |
          # Configure Git
          git config --global user.name "Security-Bot"
          git config --global user.email "bot@example.com"
          
          # Write secret to a file
          echo "Welcome to TechHustleWithUG" > sample.txt
          
          # Push to the repository
          git add leaked_secret.txt
          git commit -m "[Skip CI] demo commit"
          git push
```

1. Update GitHub repository setting as: Go to Repository Settings â€”> Click on **Actions** on left menu â†’ Then click on **General** â€”> Under **Workflow permissions** select **Read and write permissions â†’** Click on Save
2. Rerun Workflow and it will pass.

But this is not a good practice instead keep default permission as **Read repository contents and packages permissions** under **Actions** settings in repository and add below to your workflow which will enforce user to give explicit permission to github actions workflow

```yaml
permissions:
contents: write
```
